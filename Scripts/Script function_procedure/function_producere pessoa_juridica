CREATE OR REPLACE FUNCTION buscar_pessoa_por_cnpj(cnpj_param VARCHAR)
RETURNS TABLE (
    nr_id_pessoa INTEGER,
    nm_roles VARCHAR,
    nm_nome_razaosocial VARCHAR,
    ds_email VARCHAR,
    ds_senha VARCHAR,
    ds_telefone VARCHAR,
    ds_cnpj VARCHAR,
    nm_nome_fantasia VARCHAR,
    nm_rua VARCHAR,
    ds_numero VARCHAR,
    ds_bairro VARCHAR,
    ds_cidade VARCHAR,
    ds_cep VARCHAR,
    ds_uf VARCHAR
) AS
$$
BEGIN
    RETURN QUERY
    SELECT
        p.nr_id_pessoa,
        p.nm_roles,
        p.nm_nome_razaosocial,
        p.ds_email,
		p.ds_senha,
        p.ds_telefone,
        e.nm_rua,
        e.ds_numero,
        e.ds_bairro,
        e.ds_cidade,
        e.ds_cep,
        e.ds_uf,
		pj.ds_cnpj,
        pj.nm_nome_fantasia
    FROM pessoas p
    LEFT JOIN pessoas_juridicas pj ON p.nr_id_pessoa = pj.fk_nr_id_pessoa
    LEFT JOIN enderecos e ON p.nr_id_pessoa = e.fk_nr_id_pessoa
    WHERE pj.ds_cnpj = cnpj_param;
END;
$$ LANGUAGE plpgsql;

